@include rules
@include project
@include agent/gemini_25_pro_yolo

Voglio creare il README di presentazione per il mio tool vespe (eseguibile ctx).
Presentami un layout sensato per il README del tool.

<!-- answer-391e00d5-4ca2-4109-83e8-840e401e1f1a:begin -->
<!-- repeat-b04ff6b4-a16a-4646-926a-6819cfe49c21:begin   -->
<!-- repeat-b04ff6b4-a16a-4646-926a-6819cfe49c21:end   -->
# Project Analysis: `vespe`

## Executive Summary
The `vespe` project implements a command-line interface (`ctx`) designed for managing "contexts" and "snippets" within a development workflow. It enables users to create, execute, list, and monitor these markdown-based files, which can interact with an external AI agent (Gemini) for task automation and contextual processing.

## 1. Core Functionality
The `ctx` CLI tool provides the following primary functionalities:
*   **Project Initialization (`ctx init`):** Sets up the necessary directory structure (`.ctx`) for managing contexts and snippets within a given project.
*   **Context Management (`ctx context`):**
    *   **Creation (`new`):** Generates new context files, supporting templating via Handlebars and automatic naming for daily "diary" contexts.
    *   **Execution (`execute`):** Processes a specified context by invoking an external AI agent (Gemini) with the context's content.
    *   **Listing (`list`):** Displays all available contexts within the project.
    *   **Dependency Tree (`tree`):** (Currently incomplete/commented out) Intended to visualize the hierarchical relationships between contexts and snippets.
*   **Snippet Management (`ctx snippet`):
    *   **Creation (`new`):** Creates reusable snippet files with optional initial content.
    *   **Listing (`list`):** Displays all available snippets.
*   **Watch Mode (`ctx watch`):** Monitors context files for changes and automatically re-executes them, facilitating continuous integration or iterative AI interaction.

## 2. Key Components & Abstractions
*   **`Cli` (from `clap`):** The top-level structure defining the command-line arguments and subcommands for the `ctx` tool.
*   **`Project` (from `vespe::project`):** A central abstraction responsible for managing the project's `.ctx` directory, including:
    *   Initialization and discovery of project roots.
    *   File operations for contexts and snippets (creation, listing).
    *   Orchestration of context execution.
*   **`Context` and `Snippet`:** Conceptual entities representing markdown files. `Context` files can include other contexts and snippets, and contain directives for AI agent interaction (e.g., ` @include`, ` @summary`, ` @inline`, ` @answer`).
*   **`ShellAgentCall` (from `vespe::agent`):** An interface for interacting with external command-line AI agents. It's configured to call "gemini -p -y -m gemini-2.5-flash".
*   **`Handlebars`:** A templating engine used for generating the initial content of new context files.
*   **`watch` module:** Encapsulates the logic for monitoring file system changes and triggering context re-execution.

## 3. Design & Architecture
The project exhibits a modular, CLI-driven architecture:
*   **Modularity:** Code is organized into distinct modules (`agent`, `config`, `editor`, `execute`, `git`, `project`, `semantic`, `syntax`, `utils`), promoting separation of concerns and maintainability.
*   **CLI-centric:** The primary user interaction is through a command-line interface, making it suitable for scripting and integration into automated workflows.
*   **Context-Oriented:** The design revolves around the concept of "contexts" as self-contained units of work or information, processed by an AI.
*   **Extensible Agent Integration:** The `ShellAgentCall` abstraction allows for integration with various command-line AI agents, although currently hardcoded to Gemini.
*   **Event-Driven (Watch Mode):** The `watch` command leverages file system events to provide real-time feedback and automation.

## 4. Dependencies & Interactions
*   **Internal Dependencies:** The `ctx` binary relies heavily on the `vespe` library's internal modules (e.g., `vespe::project`, `vespe::agent`).
*   **External Rust Crates:**
    *   **CLI & Utilities:** `clap` (CLI parsing), `anyhow`, `thiserror` (error handling), `tokio`, `async-trait` (asynchronous programming), `uuid` (unique IDs), `tempfile` (temporary files), `dirs` (directory paths), `ctrlc` (signal handling), `ansi_term` (terminal colors).
    *   **Data & Text Processing:** `serde`, `serde_json` (serialization), `markdown` (markdown parsing), `handlebars` (templating), `chrono` (date/time), `regex` (regular expressions), `sha2` (hashing).
    *   **System Interaction:** `git2` (Git repository operations), `portable-pty` (pseudo-terminal interface), `notify` (file system watching).
    *   **Observability:** `tracing`, `tracing-subscriber` (logging and tracing).
*   **External AI Agent:** The tool directly interacts with an external AI agent by executing the shell command "gemini -p -y -m gemini-2.5-flash". This implies a dependency on the Gemini CLI being installed and configured in the execution environment.

## 5. Control Flow & Logic
The `main` function in `src/bin/ctx/main.rs` orchestrates the application flow:
1.  Initializes telemetry using `vespe::init_telemetry()`.
2.  Parses command-line arguments using `clap`.
3.  Determines the project root directory.
4.  Dispatches control to specific handlers based on the subcommand:
    *   `Init`: Calls `Project::init`.
    *   `Context`: Further dispatches to `New`, `Execute`, `List`, or `Tree` commands. `New` contexts are templated with Handlebars. `Execute` contexts create a `ShellAgentCall` and then invoke `project.execute_context`.
    *   `Snippet`: Dispatches to `New` or `List` commands.
    *   `Watch`: Calls the `watch::watch` function, passing the `Project` and `ShellAgentCall`.
5.  The `get_context_name` helper function dynamically generates context names for "diary" entries.

## 6. Potential Issues & Considerations
*   **Incomplete `ContextCommands::Tree`:** The commented-out implementation for displaying the context dependency tree indicates a missing or unfinished feature, which could hinder understanding complex context relationships.
*   **Tight AI Agent Coupling:** The direct invocation of a specific Gemini command creates a strong dependency on the external agent's availability and command-line interface. Changes to the Gemini CLI could break `ctx`.
*   **Security Implications:** Executing commands via `ShellAgentCall` based on context content could pose a security risk if contexts are sourced from untrusted origins or can be manipulated to inject malicious commands.
*   **Performance:** File system watching can be resource-intensive. The overall performance of context execution is heavily dependent on the AI agent's response times.
*   **Scalability:** The current execution model might not scale efficiently for a very large number of contexts or highly complex interdependencies.
*   **Test Coverage:** While `vtty_test` exists, comprehensive unit and integration tests, especially for AI agent interactions and complex context parsing, are crucial for robustness.
*   **User Experience for Complex Contexts:** Without a functional `tree` command, managing and understanding the flow of deeply nested or interconnected contexts could become challenging for users.

## 7. Contextual Relevance
The `vespe` project appears to be a foundational tool for enabling AI-assisted development or automated workflows. By structuring interactions with AI agents through "contexts" and "snippets," it aims to:
*   **Streamline AI Interaction:** Provide a consistent and version-controlled way to define tasks and prompts for AI agents.
*   **Enhance Productivity:** Automate repetitive tasks or generate content using AI, integrated directly into the development environment.
*   **Facilitate Collaboration:** Allow teams to share and version-control AI-driven workflows and reusable snippets.
*   **Integrate with IDEs:** The presence of an `extensions/vscode` directory strongly suggests an intention to integrate this functionality directly into VS Code, offering a more seamless user experience for developers.
*   **Version Control AI Interactions:** The `git2` dependency implies that the contexts and snippets, which drive AI interactions, can be version-controlled, enabling tracking of changes and collaborative development of AI-driven workflows.

---

# README Layout for `vespe` (ctx)

```markdown
# ctx: Contextual AI Assistant CLI

![CI Status](https://img.shields.io/badge/CI-Passing-brightgreen) <!-- Placeholder for CI badge -->
![Version](https://img.shields.io/badge/Version-0.1.0-blue) <!-- Placeholder for version badge -->
![License](https://img.shields.io/badge/License-MIT-yellow) <!-- Placeholder for license badge -->

A command-line interface for managing AI-driven development workflows through contextual markdown files.

## Table of Contents
- [Introduction](#introduction)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
  - [Initializing a Project](#initializing-a-project)
  - [Context Management](#context-management)
  - [Snippet Management](#snippet-management)
  - [Watch Mode](#watch-mode)
- [Core Concepts](#core-concepts)
  - [Contexts](#contexts)
  - [Snippets](#snippets)
  - [AI Agent Integration](#ai-agent-integration)
- [Configuration](#configuration)
- [Contributing](#contributing)
- [License](#license)

## Introduction
`ctx` (pronounced "context") is a powerful command-line tool designed to streamline your interactions with AI agents, integrating them seamlessly into your development workflow. By leveraging markdown-based "contexts" and reusable "snippets," `ctx` allows you to define, execute, and manage AI-driven tasks directly from your terminal. Whether you're generating code, summarizing documents, or automating complex processes, `ctx` provides a structured and version-controlled approach to AI assistance.

## Features
*   **Context Management:** Create, execute, and list markdown-based contexts that serve as prompts or instructions for your AI agent.
*   **Snippet Management:** Define and reuse common markdown snippets across multiple contexts, promoting consistency and efficiency.
*   **AI Agent Integration:** Seamlessly interact with external command-line AI agents (e.g., Gemini) to process your contexts and generate responses.
*   **Watch Mode:** Automatically re-execute contexts upon file changes, enabling iterative development and continuous feedback from your AI assistant.
*   **Project Initialization:** Easily set up `ctx` in any project with a simple initialization command.
*   **Version Control Friendly:** Designed to work hand-in-hand with Git, allowing you to version control your AI interactions and workflows.

## Installation
```bash
# Instructions on how to install ctx (e.g., cargo install, download binary)
# Example:
# cargo install ctx
```

## Usage

### Initializing a Project
To start using `ctx` in your project, navigate to your project's root directory and run:
```bash
ctx init
```
This will create a `.ctx` directory where all your contexts and snippets will be stored.

### Context Management

#### Creating a New Context
```bash
ctx context new <context_name>
# For a daily diary context:
ctx context new --diary
```

#### Executing a Context
```bash
ctx context execute <context_name>
```

#### Listing Contexts
```bash
ctx context list
```

### Snippet Management

#### Creating a New Snippet
```bash
ctx snippet new <snippet_name>
```

#### Listing Snippets
```bash
ctx snippet list
```

### Watch Mode
Monitor a context for changes and automatically re-execute it:
```bash
ctx watch <context_name>
```

## Core Concepts

### Contexts
Contexts are markdown files that encapsulate a specific task or set of instructions for an AI agent. They can include other contexts or snippets using special directives (e.g., `@include`, `@summary`, `@inline`, `@answer`).

### Snippets
Snippets are reusable markdown fragments that can be embedded into contexts. They are ideal for common prompts, code examples, or boilerplate text.

### AI Agent Integration
`ctx` interacts with external AI agents by executing a predefined shell command. Currently, it's configured to use the Gemini CLI.

## Configuration
`ctx` can be configured via environment variables or a configuration file (details to be added).

## Contributing
We welcome contributions! Please see our `CONTRIBUTING.md` for more details.

## License
This project is licensed under the MIT License. See the `LICENSE` file for details.
```
<!-- answer-391e00d5-4ca2-4109-83e8-840e401e1f1a:end -->