# Piano di Implementazione in Rust del Generatore di Dati

## Obiettivo
Sostituire lo script Python `001_big_small_training_set_generation.py` con un nuovo binario Rust, più robusto e integrato nel progetto. Tutte le specifiche funzionali esistenti verranno mantenute.

## Passi di Implementazione

### 1. Modifica della Configurazione del Progetto (`Cargo.toml`)
- **Azione:** Aggiungere le dipendenze necessarie per il nuovo binario.
- **Dipendenze da Aggiungere:**
    - `clap = { version = "4.5", features = ["derive"] }`: Per il parsing degli argomenti da riga di comando.
    - `reqwest = { version = "0.12", features = ["json"] }`: Per le chiamate HTTP asincrone all'API di Ollama.
    - `serde = { version = "1.0", features = ["derive"] }`: Framework per la serializzazione/deserializzazione.
    - `serde_json = "1.0"`: Per lavorare con dati in formato JSON.
    - `tokio = { version = "1", features = ["full"] }`: Runtime asincrono.
    - `rand = "0.8"`: Per la selezione casuale dei tool.
- **Azione:** Dichiarare il nuovo binario.
- **Configurazione:**
  ```toml
  [[bin]]
  name = "data-generator"
  path = "src/bin/data_generator.rs"
  ```

### 2. Creazione del File Sorgente del Binario
- **Azione:** Creare un nuovo file in `src/bin/data_generator.rs`.
- **Contenuto:** Il file conterrà l'intera logica dell'applicazione.

### 3. Struttura del Codice Rust (`src/bin/data_generator.rs`)

#### 3.1. Definizione delle Strutture Dati
- **Argomenti CLI:** Una struct `CliArgs` derivata con `clap::Parser` per mappare tutti gli argomenti da riga di comando (`--big-model`, `--small-model`, etc.).
- **Strutture API Ollama:** Struct per la richiesta (`GenerateRequest`) e la risposta (`GenerateResponse`) di Ollama, derivate con `serde::Serialize` e `serde::Deserialize`.
- **Definizione Tool:** Struct per `Tool`, `Parameter`, etc., derivate con `serde::Serialize` per poterle convertire in JSON per i prompt.
- **Struttura Dati di Output:** Struct per il file JSON finale (`LabeledExample`, `Span`), derivate con `serde::Serialize`.

#### 3.2. Logica Principale (`main` function)
- La funzione `main` sarà marcata con `#[tokio::main]`.
- **Workflow:**
    1.  Parsing degli argomenti da CLI usando `clap`.
    2.  Inizializzazione del client HTTP `reqwest::Client`.
    3.  Definizione statica della `TOOLS_DEFINITION` (la lista di tutti i tool disponibili).
    4.  Loop principale per generare il numero di esempi richiesto.

#### 3.3. Funzioni Helper
- **`query_ollama(client, model, prompt, system_prompt)`:** Funzione asincrona che prende un client `reqwest`, il nome del modello e i prompt, ed esegue la chiamata all'API di Ollama, gestendo la serializzazione e deserializzazione.
- **`build_system_prompt(tool_format, tools)`:** Funzione che assembla il system prompt corretto (parte normativa + specifica dei tool) in base al formato richiesto (`mcp`, `json`, `xml`).
- **`generate_student_prompt(client, teacher_model, tool_name)`:** Implementa il Passo 1 della pipeline.
- **`get_student_response(client, student_model, student_prompt, tool_format)`:** Implementa il Passo 2.
- **`label_student_response(client, teacher_model, ...)`:** Implementa il Passo 3.
- **`save_labeled_example(output_dir, example_data, index)`:** Implementa il Passo 4, gestendo la creazione della directory e la scrittura del file.

### 4. Versioning con Git
1.  **Commit 1 (Pianificazione):** Aggiunta di questo file di piano.
2.  **Commit 2 (Configurazione):** Modifiche al `Cargo.toml` con le nuove dipendenze e la definizione del binario.
3.  **Commit 3 (Implementazione):** Aggiunta del nuovo file `src/bin/data_generator.rs` con l'implementazione completa.
4.  **(Opzionale) Commit 4 (Pulizia):** Rimozione dello script Python non più necessario. (Da confermare con l'utente).
