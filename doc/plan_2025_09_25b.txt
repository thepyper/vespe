## Plan for Task Editing/Creation UI in `vespe-tui`

### Objective

Create a graphical user interface within `vespe-tui` that allows users to:
1.  **Create a new task**: This will involve calling `Project::create_task`.
2.  **Edit an existing task**: This will involve loading a task, modifying its properties (initially `name` and `objective`), and then saving those changes using `Project::define_objective` and potentially updating the `TaskConfig` (for `name`).

The UI will be designed to facilitate both creation (by creating a new task and immediately entering edit mode) and direct editing of existing tasks.

### API Functions to Utilize

*   `Project::create_task(parent_uid: Option<String>, name: String, created_by_agent_uid: String, _template_name: String)`: For initial task creation.
*   `Project::define_objective(task_uid: &str, objective_content: String)`: For setting/updating the task's objective.
*   `Project::load_task(uid: &str)`: For loading an existing task into the editor.
*   `Project::list_all_tasks()`: To allow selection of a task to edit.
*   `Task` struct and `TaskConfig` struct: To access and display task properties.

### UI Design and Workflow

The UI will have two main modes: **Task Selection Mode** and **Task Edit Mode**.

#### Task Selection Mode

1.  **Display a list of existing tasks**: Show `Task.config.name` and `Task.uid`.
2.  **Option to "Create New Task"**: This will transition to Task Edit Mode with an empty task.
3.  **Option to "Edit Selected Task"**: This will load the selected task and transition to Task Edit Mode.

#### Task Edit Mode

This mode will display fields for editing a single task.

1.  **Task Name (Title)**: Text input for `Task.config.name`.
2.  **Objective**: Multi-line text input for `Task.objective`.
3.  **Agent UID**: Text input for `Task.config.created_by_agent_uid`. (For now, this will be a required field, but later could be a dropdown of available agents).
4.  **Save Button (F5)**:
    *   If creating a new task:
        *   Call `Project::create_task` with the provided `name` and `created_by_agent_uid`.
        *   If successful, get the `task_uid` from the returned `Task`.
        *   Call `Project::define_objective` with the `task_uid` and `objective_content`.
        *   Update `TaskConfig.name` if it was changed (this might require a separate `Project` function or direct file manipulation, which I'll need to investigate if `Project` doesn't offer a direct `update_task_name` function). For now, I'll assume `create_task` sets the name, and subsequent edits to the name would require reloading the task and potentially re-saving its `config.json`.
    *   If editing an existing task:
        *   Call `Project::define_objective` with the current `task_uid` and `objective_content`.
        *   If `Task.config.name` was changed, update `task.config.name` and then call `task.save_config()` (assuming `Task` has a `save_config` method, or `Project` has an `update_task_config` method). If not, I'll need to implement a way to save changes to `TaskConfig`.
5.  **Cancel Button (F6)**: Discard changes and return to Task Selection Mode.

### Implementation Steps (High-Level)

1.  **Clean and Rebuild `vespe-tui`**: Ensure all previous compilation issues are resolved.
    *   `cargo clean && cargo build --package vespe-tui`
2.  **Modify `vespe-tui/src/main.rs`**:
    *   Update `Page` enum to include `TaskSelection` and `TaskEdit` (replacing `CreateTask`).
    *   Adjust `handle_events` for navigation between these new pages and handling F5/F6 actions.
    *   Add state management for `TaskSelection` (e.g., `selected_task_uid: Option<String>`) and `TaskEdit` (e.g., `task_edit_state: TaskEditState`).
3.  **Create `vespe-tui/src/pages/task_selection.rs`**:
    *   Implement `render_task_selection_page` to display a list of tasks from `app.project.list_all_tasks()`.
    *   Handle selection of tasks.
4.  **Create `vespe-tui/src/pages/task_edit.rs`**:
    *   Define `TaskEditState` struct to hold editable task fields (`name`, `objective`, `agent_uid`, `current_task_uid: Option<String>`).
    *   Implement `render_task_edit_page` to display input fields for `name`, `objective`, and `agent_uid`.
    *   Implement `InputFocus` for navigation within the edit fields.
5.  **Modify `vespe-tui/src/pages/mod.rs`**:
    *   Include `task_selection` and `task_edit` modules.
6.  **Refine `handle_events` in `main.rs` for `TaskEdit`**:
    *   When F5 (Save) is pressed:
        *   If `task_edit_state.current_task_uid` is `None` (new task):
            *   Call `app.project.create_task()`.
            *   If successful, get `task_uid`.
            *   Call `app.project.define_objective()`.
            *   Update `TaskConfig.name` if needed (requires a `Project` method or direct file write).
        *   If `task_edit_state.current_task_uid` is `Some(uid)` (editing existing):
            *   Call `app.project.define_objective()`.
            *   Update `TaskConfig.name` if needed.
    *   When F6 (Cancel) is pressed, transition back to `TaskSelection`.
7.  **Error Handling and Messages**: Continue using the message display mechanism for feedback.

### Open Questions / Assumptions

*   **`created_by_agent_uid`**: For now, this will be a simple text input. In the future, it should be a dropdown populated by `Project::list_agents()`.
*   **Updating `TaskConfig.name`**: If `Project` doesn't have a direct `update_task_name` function, I'll need to implement a way to modify and save `config.json` for a given task. I will assume for now that `create_task` sets the name, and if the name needs to be changed for an existing task, I will need to implement a `Project::update_task_name` or similar. For the initial implementation, I will focus on `create_task` and `define_objective`.
*   **`description`, `priority`, `due_date`, `tags`**: These fields are not directly part of `Project::create_task` or `Project::define_objective`. I will omit them from the initial UI for editing, as their storage mechanism is unclear from the current API. If the user wants them, we'll need to define how they are stored (e.g., in `objective.md` content, or a new metadata file).