@include rules
@include project
@include agent/linter

voglio dividere src/ast2/mod.rs in diversi files, per migliore organizzazione.
Un problema che incontrerai e' che i test sono stati messi in una sottocartella / sottomodulo.
So che c'e' un modo (#path? o qualcosa di simile) che permette di "includere" dei files,
in modo da mantenere la sottocartella separata, ma dal punto di vista di rust tenere i test 
nello stesso modulo (ast2). Vorrei usassi questo approccio.

Nel mentre vorrei anche rendere privata la API, all'esterno si devono vedere solamente: parse_document e i tipi della AST che ritorna. il resto e' privato. 

Riguardo i test, vorrei mantenere come ora molti files separati, non unire tutto in un unico file.

Studia il codice e proponi un refactoring in files.
Non eseguirlo, chiedi prima la mia approvazione.

<!-- answer-6437d07d-21dd-4b2d-87f2-b6cf893144a2:begin -->
Comprendo. Procederò con un'analisi approfondita di `src/ast2/mod.rs` per proporre un refactoring che divida il codice in più file, mantenendo i test separati ma inclusi nel modulo `ast2` tramite l'attributo `#[path]`. Renderò l'API privata, esponendo solo `parse_document` e i tipi AST correlati.

Inizierò leggendo il contenuto del file:
Il file `src/ast2/mod.rs` contiene l'intera definizione dell'AST e la logica di parsing. Propongo di suddividere questo file in moduli più piccoli per migliorare l'organizzazione e la manutenibilità, mantenendo l'API esterna pulita e privata per la maggior parte delle funzioni.

### Piano di Refactoring Proposto

Creerò i seguenti nuovi file all'interno della directory `src/ast2/`:

1.  **`src/ast2/types.rs`**: Conterrà tutte le definizioni delle strutture dati pubbliche che compongono l'AST, come `Position`, `Range`, `Ast2Error`, `CommandKind`, `Tag`, `Anchor`, `Content`, `Document`, e i tipi correlati. Queste saranno le uniche entità pubbliche esposte dal modulo `ast2`, oltre alla funzione `parse_document`.

2.  **`src/ast2/parser.rs`**: Conterrà la definizione della struct `Parser` e tutti i suoi metodi associati per la gestione dello stato del parsing (avanzamento, consumo di caratteri, ecc.). Questo modulo sarà privato.

3.  **`src/ast2/parse_utils.rs`**: Conterrà funzioni di utilità per il parsing, come `_try_parse_identifier`, `_try_parse_uuid`, e le funzioni per il parsing di stringhe e valori (nudi o racchiusi). Questo modulo sarà privato.

4.  **`src/ast2/parse_elements.rs`**: Conterrà la logica di parsing per gli elementi principali del documento, come `_try_parse_tag`, `_try_parse_anchor`, `_try_parse_parameters`, `_try_parse_arguments`, `_try_parse_value`, `_try_parse_text`, `_try_parse_command_kind`, `_try_parse_anchor_kind`. Questo modulo sarà privato.

Il file **`src/ast2/mod.rs`** diventerà il modulo principale e avrà i seguenti compiti:

*   Dichiarare i nuovi sottomoduli (`types`, `parser`, `parse_utils`, `parse_elements`).
*   Riesportare i tipi pubblici da `types.rs` e la funzione `parse_document`.
*   Contenere la funzione `parse_document`, che orchestrerà il processo di parsing utilizzando le funzioni dai moduli privati.
*   Mantenere il blocco `#[cfg(test)] mod tests`, utilizzando l'attributo `#[path]` per includere i file di test esistenti dalla sottocartella `tests/` come sottomoduli del modulo `tests`. Questo garantirà che i test rimangano separati ma logicamente parte del modulo `ast2::tests`.

### Visibilità dell'API

*   La funzione `parse_document` e tutti i tipi definiti in `src/ast2/types.rs` saranno `pub`.
*   Tutte le altre funzioni e strutture nei moduli `parser.rs`, `parse_utils.rs` e `parse_elements.rs` saranno private (implicitamente o esplicitamente `pub(crate)` se necessario per la comunicazione interna al modulo `ast2`).

Questo approccio garantirà una chiara separazione delle responsabilità, migliorerà la leggibilità del codice e manterrà la struttura dei test esistente, rendendo al contempo privata la logica di parsing interna.

Approvi questo piano di refactoring?
<!-- answer-6437d07d-21dd-4b2d-87f2-b6cf893144a2:end -->