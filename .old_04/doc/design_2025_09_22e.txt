# Design - Entità Agente (Agent)

## Obiettivo
Definire la struttura e il comportamento degli agenti LLM all'interno del sistema Vespe, permettendo la loro configurazione, specializzazione gerarchica e gestione tramite il filesystem.

## Struttura Filesystem degli Agenti

Coerentemente con la gestione dei task, ogni agente sarà rappresentato da una directory il cui nome sarà un UID univoco. Tutte le directory degli agenti saranno contenute in una cartella base (es. `.vespe/agents/`).

**Esempio di struttura:**

```
.vespe/agents/
├── agt-abc123def456/  // Agente "Generico" o "Base"
│   ├── config.json
│   ├── system_prompt.md
│   └── description.md
├── agt-xyz789uvw012/  // Agente "Sviluppatore Backend" (specializza da agt-abc123def456)
│   ├── config.json
│   ├── system_prompt.md // Potrebbe estendere o sovrascrivere quello del genitore
│   └── description.md
└── agt-pqr012stu345/  // Agente "Sviluppatore Frontend" (specializza da agt-abc123def456)
    ├── config.json
    ├── system_prompt.md
    └── description.md
```

Questa scelta garantisce unicità, robustezza a ridenominazioni e coerenza con l'approccio "filesystem flat" adottato per i task. La gerarchia e i nomi leggibili saranno gestiti e presentati tramite le API del sistema.

## Concetto di Specializzazione e Gerarchia

Gli agenti potranno specializzare da altri agenti, creando una gerarchia di ereditarietà delle configurazioni. Questo permette:
*   **Riutilizzabilità:** Definire comportamenti, prompt o set di tool comuni una sola volta.
*   **Consistenza:** Assicurare che agenti correlati aderiscano a un set di regole di base.
*   **Gestibilità:** Semplificare la creazione e la manutenzione di varianti di agenti.

L'ereditarietà sarà gestita risalendo la catena dei `parent_agent_uid` e unendo le proprietà. Le proprietà dell'agente "figlio" avranno precedenza su quelle del "genitore" in caso di conflitto.

## File di Configurazione dell'Agente

Ogni directory UID dell'agente conterrà i seguenti file:

1.  **`config.json`**: Contiene i metadati e le configurazioni strutturate dell'agente.
    *   `uid`: Stringa univoca per identificare l'agente (es. `agt-UUID`).
    *   `name`: Nome leggibile dell'agente (es. "Agente Sviluppatore").
    *   `created_by`: Utente o agente che ha creato l'agente.
    *   `created_at`: Timestamp di creazione.
    *   `parent_agent_uid`: (Opzionale) UID dell'agente genitore da cui questo agente specializza.
    *   `model_id`: Identificativo del modello LLM da utilizzare (es. "ollama/llama3", "gemini/pro").
    *   `temperature`: Parametro di creatività dell'LLM.
    *   `top_p`: Parametro di campionamento dell'LLM.
    *   `default_tools`: Array di UID dei tool a cui l'agente ha accesso di default.
    *   `context_strategy`: (Opzionale) Regole su come l'agente dovrebbe gestire e includere la storia del task (`persistent/`) nei prompt.

2.  **`system_prompt.md`**:
    *   Contiene il prompt di sistema di base che definisce la personalità, il ruolo e le istruzioni generali per l'LLM.
    *   In caso di ereditarietà, il prompt finale dell'agente potrebbe essere una combinazione (es. concatenazione) del prompt del genitore e del proprio.

3.  **`description.md`**:
    *   Una descrizione leggibile dello scopo, delle capacità e delle limitazioni dell'agente. Utile per la documentazione e la selezione manuale.

## Implicazioni API (Crate `project` o `agent_manager`)

Le API per gli agenti dovranno supportare:
*   **`create_agent(parent_agent_uid: Option<String>, name: String, ...)`**: Creazione di un nuovo agente, con possibilità di specificare un genitore per l'ereditarietà.
*   **`load_agent(uid: &str) -> Agent`**: Caricamento di un agente, che include la risoluzione della sua configurazione completa tramite la catena di ereditarietà.
*   **`list_agents(filter: AgentFilter) -> Vec<Agent>`**: Elenco degli agenti, con possibilità di filtro.
*   **`get_agent_full_prompt(uid: &str, task_context: &TaskContext) -> String`**: Funzione per ottenere il prompt completo da inviare all'LLM, considerando l'ereditarietà e il contesto specifico del task.
