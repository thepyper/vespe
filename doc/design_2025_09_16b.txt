# Design Document: Progetto "Vespe" - Struttura di Directory e Moduli

## 1. Introduzione

Questo documento propone una struttura di directory e moduli per il progetto "Vespe", un sistema multi-agente autonomo implementato in Rust. La struttura è pensata per organizzare il codice in modo logico, separando le responsabilità e facilitando lo sviluppo, la manutenzione e l'estensione del sistema.

## 2. Struttura di Directory Principale

```
vespe/
├── Cargo.toml
├── Cargo.lock
├── README.md
├── .gitignore
├── .vespe/                     # Cartella per configurazioni e dati specifici del progetto (vedi 3.1)
│   ├── agents/                 # Definizioni degli agenti (JSON/YAML)
│   ├── tasks/                  # Definizioni dei task/missioni (JSON/YAML)
│   ├── memory/                 # Memoria locale (es. SQLite DB, Vector DB files)
│   ├── logs/                   # Log delle attività
│   └── config.toml             # Override di configurazione specifici del progetto
└── src/                        # Codice sorgente Rust
    ├── main.rs                 # Punto di ingresso dell'applicazione
    ├── lib.rs                  # Libreria principale del progetto (se applicabile)
    ├── config/                 # Gestione della configurazione (globale e locale)
    │   ├── mod.rs              # Modulo principale per la configurazione
    │   └── models.rs           # Strutture dati per la configurazione
    ├── agent/                  # Definizione e logica degli agenti
    │   ├── mod.rs              # Modulo principale per gli agenti
    │   ├── agent_manager.rs    # Gestione del ciclo di vita e istanziazione degli agenti
    │   ├── agent_trait.rs      # Trait per definire l'interfaccia di un agente
    │   ├── models.rs           # Strutture dati per la definizione di un agente (name, llm_config, etc.)
    │   └── impls/              # Implementazioni di agenti specifici (es. DebugAgent, ResearchAgent)
    │       ├── mod.rs
    │       └── debug_agent.rs
    ├── orchestrator/           # Logica del "Grand-Manager"
    │   ├── mod.rs              # Modulo principale per l'orchestratore
    │   ├── orchestrator.rs     # Implementazione del Grand-Manager
    │   └── task_manager.rs     # Gestione e assegnazione dei task
    ├── communication/          # Protocollo di comunicazione tra agenti
    │   ├── mod.rs              # Modulo principale per la comunicazione
    │   ├── message.rs          # Struttura del messaggio
    │   └── channel.rs          # Implementazione dei canali di comunicazione (es. MPSC, bacheca)
    ├── memory/                 # Gestione della memoria (a breve e lungo termine)
    │   ├── mod.rs              # Modulo principale per la memoria
    │   ├── short_term.rs       # Gestione della memoria a breve termine (contesto del prompt)
    │   ├── long_term/          # Memoria a lungo termine
    │   │   ├── mod.rs
    │   │   ├── file_system.rs  # Accesso al file system per memoria persistente
    │   │   ├── structured_db.rs# Interfaccia per DB strutturati (es. SQLite)
    │   │   └── vector_db.rs    # Interfaccia per DB vettoriali
    │   └── models.rs           # Strutture dati per la memoria (es. embeddings)
    ├── tools/                  # Definizione e registro degli strumenti
    │   ├── mod.rs              # Modulo principale per gli strumenti
    │   ├── tool_registry.rs    # Registro degli strumenti disponibili
    │   ├── tool_trait.rs       # Trait per definire l'interfaccia di uno strumento
    │   └── impls/              # Implementazioni di strumenti specifici (es. WebSearch, CodeExecutor)
    │       ├── mod.rs
    │       └── web_search.rs
    ├── llm/                    # Interfacce e wrapper per i Large Language Models
    │   ├── mod.rs              # Modulo principale per gli LLM
    │   ├── llm_client.rs       # Client generico per interagire con diversi LLM
    │   ├── providers/          # Implementazioni specifiche per provider LLM (es. OpenAI, Ollama)
    │   │   ├── mod.rs
    │   │   ├── openai.rs
    │   │   └── ollama.rs
    │   └── models.rs           # Strutture dati per le configurazioni LLM e le risposte
    ├── cli/                    # Interfaccia a riga di comando (se presente)
    │   ├── mod.rs
    │   └── commands.rs         # Definizione dei comandi CLI (es. `vespe run <task_id>`)
    └── utils/                  # Funzioni di utilità generiche
        ├── mod.rs
        ├── error.rs            # Gestione degli errori personalizzata
        └── logging.rs          # Configurazione del logging
```

## 3. Dettaglio dei Componenti

### 3.1. `.vespe/` (Cartella di Contesto del Progetto)

Questa cartella, situata nella radice di ogni progetto Git in cui "Vespe" opera, contiene tutte le configurazioni e i dati specifici per quel progetto. È fondamentale per la portabilità e l'isolamento del contesto.

*   **`agents/`**: Contiene i file di definizione degli agenti in formato JSON o YAML. Ogni file (es. `developer_agent.json`, `qa_agent.yaml`) descrive un agente specifico con i suoi campi (`name`, `llm_config`, `personality`, `tools`, ecc.).
*   **`tasks/`**: Contiene i file di definizione dei task o delle missioni in formato JSON o YAML. Ogni file (es. `fix_bug_task.json`, `implement_feature_task.yaml`) descrive un compito che il sistema "Vespe" deve eseguire, inclusi parametri, dipendenze e criteri di successo.
*   **`memory/`**: Archivia la memoria a lungo termine specifica del progetto.
    *   Potrebbe contenere un file SQLite (`project_memory.db`) per la memoria strutturata.
    *   Potrebbe contenere file per un database vettoriale locale (es. indici Faiss, dati ChromaDB).
    *   Potrebbe anche contenere file di testo o JSON per fatti appresi o osservazioni.
*   **`logs/`**: Contiene i file di log generati dalle attività degli agenti e dell'orchestratore per questo progetto specifico.
*   **`config.toml`**: Un file di configurazione che permette di sovrascrivere le impostazioni globali del sistema con valori specifici per il progetto corrente.

### 3.2. `src/` (Codice Sorgente Rust)

#### 3.2.1. `main.rs`

*   **Ruolo:** Il punto di ingresso dell'applicazione. Si occupa di:
    *   Inizializzare il sistema di logging.
    *   Caricare la configurazione globale e quella specifica del progetto.
    *   Inizializzare l'orchestratore (`Grand-Manager`).
    *   Parsare gli argomenti della riga di comando (tramite il modulo `cli`).
    *   Avviare l'esecuzione del task o l'interfaccia utente.

#### 3.2.2. `config/`

*   **Ruolo:** Gestisce il caricamento, la validazione e l'accesso alle configurazioni del sistema.
    *   **`mod.rs`**: Contiene la logica per caricare la configurazione globale (da `~/.config/vespe/` o `/etc/vespe/`) e la configurazione specifica del progetto (da `.vespe/config.toml`), gestendo la gerarchia di override.
    *   **`models.rs`**: Definisce le strutture dati Rust (`struct`) che rappresentano la configurazione del sistema (es. `GlobalConfig`, `ProjectConfig`, `LlmProviderConfig`).

#### 3.2.3. `agent/`

*   **Ruolo:** Contiene tutta la logica relativa alla definizione, gestione e comportamento degli agenti.
    *   **`mod.rs`**: Esporta i moduli interni e può contenere logica comune a tutti gli agenti.
    *   **`agent_manager.rs`**: Responsabile dell'istanziazione degli agenti dalle loro definizioni, della gestione del loro ciclo di vita (avvio, pausa, stop) e del mantenimento di un registro degli agenti attivi.
    *   **`agent_trait.rs`**: Definisce il `trait` Rust che ogni implementazione di agente deve implementare. Questo trait specifica l'interfaccia pubblica di un agente (es. `execute_task`, `handle_message`).
    *   **`models.rs`**: Definisce le strutture dati Rust che rappresentano la definizione di un agente (es. `AgentDefinition` con campi come `name`, `llm_config`, `personality`, `tooling`, `allowed_recipients`, `memory_access_level`, ecc.). Queste strutture vengono deserializzate dai file JSON/YAML.
    *   **`impls/`**: Contiene le implementazioni concrete di diversi tipi di agenti.
        *   **`mod.rs`**: Esporta le implementazioni degli agenti.
        *   **`debug_agent.rs`**: Implementazione di un agente specializzato nel debugging di codice.
        *   **`research_agent.rs`**: Implementazione di un agente per la ricerca di informazioni sul web o in basi di conoscenza.
        *   *(Altri file per agenti specifici come `code_generator_agent.rs`, `qa_agent.rs`, ecc.)*

#### 3.2.4. `orchestrator/`

*   **Ruolo:** Incarna la logica del "Grand-Manager", il cervello del sistema.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`orchestrator.rs`**: Contiene la logica principale del Grand-Manager:
        *   Caricamento e interpretazione delle definizioni di agenti e task.
        *   Assegnazione dei task agli agenti appropriati.
        *   Coordinamento generale del flusso di lavoro.
        *   Gestione degli errori e del monitoraggio del progresso.
    *   **`task_manager.rs`**: Gestisce il ciclo di vita dei task, le dipendenze tra task, l'esecuzione parallela/sequenziale e i criteri di successo.

#### 3.2.5. `communication/`

*   **Ruolo:** Definisce e implementa il protocollo di comunicazione tra gli agenti.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`message.rs`**: Definisce la struttura dati per i messaggi scambiati tra gli agenti (es. mittente, destinatario, tipo di messaggio, payload).
    *   **`channel.rs`**: Implementa i meccanismi di comunicazione sottostanti (es. canali MPSC - Multi-Producer, Single-Consumer, una "bacheca" condivisa, o un'API interna).

#### 3.2.6. `memory/`

*   **Ruolo:** Gestisce l'accesso e la persistenza della memoria del sistema.
    *   **`mod.rs`**: Esporta i moduli interni e può contenere l'interfaccia unificata per la memoria.
    *   **`short_term.rs`**: Gestisce la memoria a breve termine, tipicamente il contesto della conversazione che viene incluso nel prompt dell'LLM.
    *   **`long_term/`**: Contiene le implementazioni per i diversi tipi di memoria a lungo termine.
        *   **`mod.rs`**: Esporta i moduli interni.
        *   **`file_system.rs`**: Funzioni per leggere e scrivere file sul disco (per configurazioni, log, dati semplici).
        *   **`structured_db.rs`**: Interfaccia e implementazione per l'interazione con database strutturati (es. SQLite per la memoria locale del progetto).
        *   **`vector_db.rs`**: Interfaccia e implementazione per l'interazione con database vettoriali (per la memoria semantica e RAG).
    *   **`models.rs`**: Definisce le strutture dati relative alla memoria (es. `Embedding`, `MemoryEntry`).

#### 3.2.7. `tools/`

*   **Ruolo:** Gestisce la definizione, il registro e l'esecuzione degli strumenti esterni che gli agenti possono utilizzare.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`tool_registry.rs`**: Mantiene un elenco di tutti gli strumenti disponibili nel sistema, con le loro descrizioni, schemi di input/output e capacità.
    *   **`tool_trait.rs`**: Definisce il `trait` Rust che ogni strumento deve implementare, specificando l'interfaccia per l'esecuzione dello strumento.
    *   **`impls/`**: Contiene le implementazioni concrete di diversi strumenti.
        *   **`mod.rs`**: Esporta le implementazioni degli strumenti.
        *   **`web_search.rs`**: Implementazione di uno strumento per eseguire ricerche sul web.
        *   **`code_executor.rs`**: Implementazione di uno strumento per eseguire frammenti di codice (es. Rust, Python).
        *   *(Altri file per strumenti specifici come `file_io.rs`, `api_caller.rs`, ecc.)*

#### 3.2.8. `llm/`

*   **Ruolo:** Fornisce un'interfaccia astratta per interagire con diversi Large Language Models.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`llm_client.rs`**: Un client generico che incapsula la logica per inviare prompt e ricevere risposte dagli LLM, gestendo la configurazione (`llm_config`) e i parametri.
    *   **`providers/`**: Contiene le implementazioni specifiche per l'interazione con diversi provider LLM.
        *   **`mod.rs`**: Esporta i moduli dei provider.
        *   **`openai.rs`**: Implementazione per l'API OpenAI.
        *   **`ollama.rs`**: Implementazione per l'interazione con modelli locali tramite Ollama.
        *   *(Altri file per provider come `google_gemini.rs`, `huggingface.rs`, ecc.)*
    *   **`models.rs`**: Definisce le strutture dati per i messaggi LLM (es. `ChatMessage`, `Prompt`), le configurazioni specifiche dei provider e le risposte.

#### 3.2.9. `cli/`

*   **Ruolo:** Gestisce l'interfaccia a riga di comando per l'interazione con l'utente.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`commands.rs`**: Definisce i comandi CLI disponibili (es. `vespe run <task_id>`, `vespe agent list`, `vespe config show`) utilizzando una crate come `clap`.

#### 3.2.10. `utils/`

*   **Ruolo:** Contiene funzioni di utilità generiche e helper che possono essere usate in tutto il progetto.
    *   **`mod.rs`**: Esporta i moduli interni.
    *   **`error.rs`**: Definisce tipi di errore personalizzati per una gestione degli errori coerente in tutto il sistema.
    *   **`logging.rs`**: Configura il sistema di logging (es. `tracing` o `log` crate) per l'applicazione.

---

Questa struttura fornisce una base solida per lo sviluppo del progetto "Vespe", permettendo una chiara separazione delle preoccupazioni e facilitando l'aggiunta di nuove funzionalità, agenti, strumenti o provider LLM in futuro.
