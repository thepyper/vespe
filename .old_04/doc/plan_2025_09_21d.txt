# Piano di Refactoring per il Binario `data-generator`

## Obiettivo
Migliorare la manutenibilità e la struttura del codice del binario `data-generator` suddividendolo in moduli con responsabilità specifiche, seguendo le convenzioni di Rust.

## Passi di Implementazione

### 1. Riorganizzazione della Struttura dei File
- **Azione:** Creare una nuova directory per il binario per trasformarlo in un modulo multi-file.
    1. Creare la directory: `src/bin/data_generator/`
    2. Spostare il file `src/bin/data_generator.rs` in `src/bin/data_generator/main.rs`.
- **Azione:** Aggiornare `Cargo.toml` per puntare al nuovo percorso del `main`.
    - **Da:** `path = "src/bin/data_generator.rs"`
    - **A:** `path = "src/bin/data_generator/main.rs"`

### 2. Suddivisione del Codice in Moduli
- **Azione:** Creare nuovi file (moduli) all'interno di `src/bin/data_generator/` e spostare il codice esistente.

#### Modulo 1: `models.rs`
- **Contenuto:** Tutte le definizioni delle strutture dati principali.
- **Elementi da spostare:**
    - Structs: `Tool`, `ToolParameter`, `CliArgs`, `OllamaGenerateRequest`, `OllamaGenerateResponse`, `LabeledExample`, `Span`.
    - Definizioni statiche: `TOOLS_DEFINITION`.

#### Modulo 2: `prompts.rs`
- **Contenuto:** Logica per la costruzione dei system prompt.
- **Elementi da spostare:**
    - Costanti: `NORMATIVE_SYSTEM_PROMPT`.
    - Funzioni: `build_mcp_tool_spec`, `build_json_tool_spec`, `build_xml_tool_spec`.

#### Modulo 3: `ollama.rs`
- **Contenuto:** Tutta la logica per interagire con l'API di Ollama.
- **Elementi da spostare:**
    - Funzione: `query_ollama`.

#### Modulo 4: `pipeline.rs`
- **Contenuto:** Le funzioni che orchestrano i passi della pipeline di generazione.
- **Elementi da spostare:**
    - Funzioni: `generate_student_prompt`, `get_student_response`, `label_student_response`, `save_labeled_example`.

### 3. Aggiornamento del `main.rs`
- **Azione:** Modificare `src/bin/data_generator/main.rs` per renderlo il punto di ingresso che utilizza i nuovi moduli.
- **Contenuto:**
    - Dichiarazioni dei moduli: `mod models;`, `mod prompts;`, `mod ollama;`, `mod pipeline;`.
    - Istruzioni `use` per importare le funzioni e le struct necessarie dai nuovi moduli.
    - La funzione `main` rimarrà qui, ma sarà molto più snella, in quanto si limiterà a chiamare le funzioni di alto livello definite in `pipeline.rs`.

### 4. Versioning con Git
1.  **Commit 1 (Pianificazione):** Aggiunta di questo file di piano.
2.  **Commit 2 (Ristrutturazione):** Modifiche alla struttura dei file, aggiornamento di `Cargo.toml` e creazione dei nuovi file vuoti.
3.  **Commit 3 (Refactoring):** Spostamento del codice nei rispettivi moduli e aggiornamento del `main.rs`.
4.  **Commit 4 (Verifica):** Esecuzione di `cargo build` per assicurarsi che il progetto compili ancora correttamente dopo il refactoring.
