# Plan for Enhanced Logging

This plan details the steps to introduce a structured logging system to provide clear insights into the agent's operations.

## 1. Create a Centralized Logger

- **Action:** Create a new file `src/logging.rs`.
- **Content:** This file will contain a `Logger` struct responsible for all logging.
- **Details:**
    - The `Logger` will be initialized with a file path (e.g., `vespe.log`).
    - It will have specific methods for different logging events:
        - `log_llm_query(messages: &Vec<LlmChatMessage>)` to log the exact query sent to the LLM.
        - `log_llm_response(response: &str)` to log the raw response from the LLM.
        - `log_tool_call(tool_name: &str, args: &serde_json::Value)` to log the tool being called and its arguments.
        - `log_tool_return(tool_name: &str, output: &serde_json::Value)` to log the value returned by the tool.

## 2. Integrate Logger into the LLM Client

- **File to modify:** `src/llm/llm_client.rs`
- **Action:** Modify the `generate_response` function to accept a mutable reference to the `Logger`.
- **Details:**
    - Before sending the request to the LLM, call `logger.log_llm_query()`.
    - After receiving the response, call `logger.log_llm_response()`.

## 3. Integrate Logger into the Tool Registry

- **File to modify:** `src/tools/tool_registry.rs`
- **Action:** Modify the `execute_tool` function to accept a mutable reference to the `Logger`.
- **Details:**
    - Before executing the tool, call `logger.log_tool_call()`.
    - After executing the tool, call `logger.log_tool_return()`.

## 4. Update the Basic Agent

- **File to modify:** `src/agent/impls/basic_agent.rs`
- **Actions:**
    1. In the `execute` method, create an instance of the `Logger`.
    2. Pass the logger instance to the `generate_response` and `execute_tool` calls.
    3. Refactor the tool execution loop into a separate, private function within `BasicAgent` to improve clarity and separation of concerns.

## 5. Verification

- **Action:** Build the project using `cargo build` and then run the `chat` command.
- **Verification:** Check the `vespe.log` file to ensure that all the required information (LLM queries, responses, tool calls, and returns) is being logged correctly and accurately.
